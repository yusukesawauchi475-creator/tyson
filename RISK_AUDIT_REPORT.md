# Project Tyson - リスク監査レポート（Wall Street基準）

## 🔍 失敗モード分析

### 1. ⚠️ 時差の考慮 - 重大な問題を発見

**問題点**:
- `new Date()`はローカル時間（JST）を使用
- `setHours(0, 0, 0, 0)`はローカル時間の0時に設定
- `toISOString()`はUTCに変換される
- **致命的な問題**: JST 23:00に録音 → UTC 14:00、翌日JST 00:00に録音 → UTC 前日15:00となり、日付がズレる

**影響**:
- おかんがJST 23:00に録音 → FirestoreにUTC 14:00で保存
- 翌日JST 00:00に録音 → FirestoreにUTC 前日15:00で保存
- `daysDiff`計算で連続日数が途切れる可能性

**修正が必要**: JST基準で日付を計算する必要がある

### 2. ⚠️ 接続エラー耐性 - 問題を発見

**問題点**:
- `isUploading`フラグはあるが、エラー時に確実にリセットされているか確認が必要
- ネットワークエラー時に`audioChunksRef.current`がクリアされない可能性
- エラー時に録音データが失われる可能性

**修正が必要**: エラーハンドリングの強化

### 3. ⚠️ 同時実行の不整合 - 問題を発見

**問題点**:
- `stopRecording()`が連打された場合、`mediaRecorder.onstop`が複数回呼ばれる可能性
- `isUploading`フラグのチェックが`onstop`内にあるが、非同期処理の開始前にチェックされていない
- Firestoreへの重複保存の可能性

**修正が必要**: 重複実行防止の強化
